{% extends "entries/base.html" %}
{% block content %}
    <form method="post">{% csrf_token %}
        {{ form.as_p }}
        <input type="submit" value="Save">
    </form>
    <button onclick="myFun()">Generate Story</button>
    {% if entry %}
        <a href="{% url 'story-detail' entry.id %}">
        	<button>Cancel</button>
        </a>
    {% else %}
    <script type="text/javascript">
    function myFun(){

        var p=fetch("https://api.ai21.com/studio/v1/j1-jumbo/complete", {
  headers: {
    "Authorization": "Bearer ",
    "Content-Type": "application/json"
  },
  body: JSON.stringify({
      "prompt": "write a story for give title:"+document.getElementById("id_title").value+"\n\n\nstory:",
      "numResults": 1,
      "maxTokens": 2048,
      "temperature": 0.7,
      "topKReturn": 0,
      "topP":1,
      "countPenalty": {
        "scale": 0,
        "applyToNumbers": false,
        "applyToPunctuations": false,
        "applyToStopwords": false,
        "applyToWhitespaces": false,
        "applyToEmojis": false
      },
      "frequencyPenalty": {
        "scale": 0,
        "applyToNumbers": false,
        "applyToPunctuations": false,
        "applyToStopwords": false,
        "applyToWhitespaces": false,
        "applyToEmojis": false
      },
      "presencePenalty": {
        "scale": 0,
        "applyToNumbers": false,
        "applyToPunctuations": false,
        "applyToStopwords": false,
        "applyToWhitespaces": false,
        "applyToEmojis": false
      },
      "stopSequences":["##"]
    }),
  method: "POST"
}).then((response) => response.json().then((data) => {
    var s=document.getElementById("id_content")
    s.value=data.completions[0].data.text
console.log(data.completions[0].data.text);
}));

    }
</script>
        <a href="{% url 'story-list' %}">
        	<button>Cancel</button>
        </a>
    {% endif %}
{% endblock %}